<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NFL Playoffs 2025 Season Bracket</title>
    <!-- Add html2canvas library for screenshot functionality -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --nfl-blue: #013369;
            --gold-shine: #FFD700;
            --super-gold: #fff27e;
            --bg-card: rgba(30,30,30,0.95);
            --bg-slot: #252525;
            --dim-alpha: 0.3;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #111;
            background-image: 
                radial-gradient(circle at center, transparent 0%, #000 100%),
                repeating-linear-gradient(0deg, transparent 0px, transparent 1px, rgba(255,255,255,0.03) 2px),
                linear-gradient(to bottom, #1e2b1e, #000);
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
        }

        .header-container {
            flex: 0 0 auto;
            padding: 10px 20px 0 20px;
            background: rgba(17, 17, 17, 0.9);
            backdrop-filter: blur(5px);
            z-index: 50;
            text-align: center;
            border-bottom: 1px solid #333;
        }

        h1 { 
            font-size: 1.8em; 
            letter-spacing: 2px; 
            margin: 5px 0; 
            text-shadow: 0 4px 10px rgba(0,0,0,0.8); 
            text-transform: uppercase;
        }
        
        .subtitle { 
            color: #aaa; 
            margin-bottom: 10px; 
            font-size: 0.9em; 
            font-weight: 400; 
        }

        .sb-details-bar {
            color: var(--gold-shine);
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.1) 50%, transparent 100%);
            padding: 8px 0;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            letter-spacing: 1px;
        }

        .mobile-break { display: none; }
        .desktop-sep { display: inline; }

        .bracket-wrapper {
            flex: 1 1 auto;
            display: flex;
            align-items: center;
            gap: 20px;
            overflow: auto;
            padding: 20px;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            width: 100%; 
        }

        .bracket-content-sizer {
            display: flex;
            gap: 20px;
            min-width: 1400px;
            margin: 0 auto;
        }

        .column {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            gap: 40px;
            min-width: 240px;
            scroll-snap-align: center;
            scroll-snap-stop: always;
            position: relative;
            padding-top: 40px;
        }

        .column > .round-header:first-child {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            margin-top: 10px;
            z-index: 10;
        }

        .col-divisional { gap: 150px; }
        .col-conference { gap: 300px; }
        .sb-column { justify-content: center; align-items: center; }

        .round-header {
            text-transform: uppercase; color: #888; font-size: 0.8em; font-weight: bold; margin-bottom: 10px; text-align: center;
        }

        .matchup {
            background: var(--bg-card); border: 1px solid #444; border-radius: 8px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative;
        }

        .game-meta {
            font-size: 0.7em; color: #aaa; margin-bottom: 8px; display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding-bottom: 4px;
        }

        .live-text {
            color: #ff4444;
            font-weight: bold;
            animation: pulseLive 2s infinite;
        }

        @keyframes pulseLive {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .highlight-btn {
            background: #333; 
            color: #aaa; 
            border: 1px solid #555; 
            border-radius: 4px; 
            padding: 4px 8px; 
            font-size: 0.8em; 
            cursor: pointer; 
            text-decoration: none; 
            display: block; 
            width: fit-content;
            margin: 8px auto 0 auto;
            transition: 0.2s;
        }
        .highlight-btn:hover { background: #555; color: white; border-color: #777; }

        .highlight-btn.disabled {
            background: #222;
            color: #555;
            border-color: #333;
            cursor: default;
            pointer-events: none;
            font-style: italic;
        }

        .team-slot {
            display: flex; align-items: center; padding: 6px; margin: 4px 0; background: var(--bg-slot); border-radius: 4px; border: 2px solid transparent; cursor: grab; transition: all 0.2s;
            border-left: 4px solid #444;
            position: relative;
        }
        .team-slot:active { cursor: grabbing; }
        
        .drop-target-active {
            border-color: var(--gold-shine); background: #333; box-shadow: 0 0 10px var(--gold-shine);
        }

        .empty-slot {
            background: #1a1a1a; border: 1px dashed #555; color: #555; justify-content: center; height: 35px; flex-direction: column; font-size: 0.7em; border-left: 1px dashed #555;
        }

        .logo-box {
            width: 28px; height: 28px; border-radius: 50%; margin-right: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.6em; color: white; text-shadow: 1px 1px 2px black;
        }

        .team-info { flex-grow: 1; text-align: left; }
        .name { font-weight: bold; font-size: 0.9em; display: block;}
        .seed { font-size: 0.7em; color: #999; }
        .score { font-weight: bold; font-size: 1.1em; }

        .winner { 
            border-left: 4px solid var(--gold-shine); 
            background: linear-gradient(90deg, #252525, #2f2f20); 
            opacity: 1 !important;
            filter: grayscale(0%) !important;
        }
        
        .eliminated { 
            opacity: var(--dim-alpha) !important; 
            filter: grayscale(100%) !important; 
            border-left: 4px solid #333 !important;
        }
        
        .real-loser {
            pointer-events: none;
            opacity: 0.2 !important;
        }
        
        .sb-logo-container {
            display: flex; justify-content: center; align-items: center; margin-bottom: 20px;
        }
        .sb-img {
            height: 100px;
            width: auto;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.8));
        }

        .ultimate-slot { height: 60px; font-size: 1.2em; border-width: 3px; }

        .ultimate-champion {
            background: linear-gradient(90deg, #4f4f20, #8f7f10) !important;
            border-left: 4px solid var(--super-gold) !important;
            border-color: var(--super-gold) !important;
            box-shadow: 0 0 30px var(--super-gold), inset 0 0 20px var(--gold-shine) !important;
            animation: championPulse 1.5s infinite alternate;
        }

        @keyframes championPulse {
            0% { box-shadow: 0 0 20px var(--super-gold); }
            100% { box-shadow: 0 0 50px var(--super-gold), 0 0 100px var(--gold-shine); filter: brightness(1.2); }
        }

        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .confetti-piece { position: absolute; width: 10px; height: 20px; background: #ffd700; top: -20px; opacity: 0; }
        
        .drag-clone {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.9;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            transform: scale(1.05);
        }

        .save-btn {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold-shine);
            color: black;
            border: 2px solid #fff;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            z-index: 10001;
            display: none; 
            cursor: pointer;
            transition: all 0.2s;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .save-btn:active { transform: translateX(-50%) scale(0.95); }

        @media (min-width: 1025px) {
            .save-btn { display: none !important; }
        }

        @keyframes popIn {
            from { bottom: -50px; opacity: 0; }
            to { bottom: 90px; opacity: 1; }
        }
        
        #save-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 20000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        #save-modal img {
            max-width: 100%;
            max-height: 70vh;
            border: 2px solid #fff;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }
        #save-modal p {
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2em;
        }
        #save-modal button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.1em;
            background: #333;
            color: #fff;
            border: 1px solid #777;
            border-radius: 5px;
        }

        .taking-screenshot .mobile-nav, 
        .taking-screenshot .highlight-btn, 
        .taking-screenshot .save-btn,
        .taking-screenshot .header-container {
            display: none !important; 
        }

        #temp-custom-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 30px 0 10px 0;
            background: #111;
            z-index: 9999;
        }
        #temp-custom-header h1 {
            font-size: 3em;
            color: white;
            text-transform: uppercase;
            margin: 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.8);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.9);
            border: 1px solid #555;
            border-radius: 50px;
            padding: 6px 10px;
            z-index: 10000;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .mobile-btn {
            background: #333;
            color: #ddd;
            border: 1px solid #555;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
        }

        .mobile-btn:active {
            background: var(--gold-shine);
            color: black;
            border-color: var(--gold-shine);
            transform: scale(0.95);
        }
        
        .mobile-btn-primary {
            background: #444;
            color: white;
            border-color: #777;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        @media (max-width: 1024px) {
            .mobile-nav { display: flex; }
            .header-container { padding: max(2px, env(safe-area-inset-top)) 10px 0 10px; }
            h1 { font-size: 1.1em; margin: 0; display: block; visibility: visible; line-height: 1.1; }
            .subtitle { font-size: 0.7em; margin-bottom: 2px; display: block; } 
            .sb-details-bar { font-size: 0.6em; padding: 3px 0; margin: 2px 0 2px 0; line-height: 1.2; }
            .mobile-break { display: block; }
            .desktop-sep { display: none; }
            .bracket-wrapper { align-items: stretch; padding: 0 5px; height: 100%; gap: 5px; overflow-y: hidden; }
            .bracket-content-sizer { height: 100%; align-items: flex-start; min-width: auto; gap: 5px; padding-right: 25px; }
            .column { gap: 8px; justify-content: flex-start; padding-top: 5px; padding-bottom: 60px; height: 100%; min-width: 45vw; scroll-snap-align: center; position: static; }
            .column > .round-header:first-child { position: static; width: auto; margin-top: 0; }
            .col-divisional, .col-conference { gap: 20px; }
            .matchup { padding: 4px; border-radius: 6px; }
            .round-header { margin-bottom: 3px; font-size: 0.7em; color: #666; }
            .team-slot { padding: 2px 4px; min-height: 28px; margin: 2px 0; }
            .logo-box { width: 16px; height: 16px; font-size: 0.5em; margin-right: 4px; }
            .name { font-size: 0.75em; } 
            .seed { font-size: 0.65em; }
            .score { font-size: 0.8em; }
            .game-meta { font-size: 0.6em; margin-bottom: 2px; padding-bottom: 2px; }
            .highlight-btn { font-size: 0.65em; padding: 2px 6px; margin-top: 2px; }
            .sb-img { height: 50px; }
            .ultimate-slot { height: 40px; }
        }
    </style>
</head>
<body>

    <div class="header-container">
        <h1>NFL Playoffs 2025 Season</h1>
        <p class="subtitle">Build your NFL bracket.</p>
        <div class="sb-details-bar">
            Super Bowl LX • Feb 8, 3:30 PM PT<span class="desktop-sep"> • </span><br class="mobile-break">Levi's Stadium, Santa Clara, CA
        </div>
    </div>

    <div class="mobile-nav">
        <button class="mobile-btn" onclick="scrollToId('afc-wc-col')">AFC</button>
        <button class="mobile-btn" onclick="scrollBracket(-1)">&lt;</button>
        <button class="mobile-btn mobile-btn-primary" onclick="scrollToId('sb-col')">SB</button>
        <button class="mobile-btn" onclick="scrollBracket(1)">&gt;</button>
        <button class="mobile-btn" onclick="scrollToId('nfc-wc-col')">NFC</button>
    </div>

    <button id="save-bracket-btn" class="save-btn" onclick="saveBracket()">
        Save Bracket
    </button>
    
    <div id="save-modal">
        <img id="save-modal-img" src="" alt="Bracket">
        <p>Long press the image to save it to your Photos.</p>
        <button onclick="document.getElementById('save-modal').style.display='none'">Close</button>
    </div>

    <div class="bracket-wrapper" id="bracket-container">
        <div class="bracket-content-sizer">
            <!-- ================= AFC SIDE ================= -->
            <div class="column" id="afc-wc-col">
                <div class="round-header">AFC Wild Card</div>
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=OZrEboMLou4">
                    <div class="game-meta"><span>FINAL</span><span>CBS</span></div>
                    <div class="team-slot winner manual-winner" draggable="true" data-conf="AFC" data-team="Bills" data-seed="6" data-color="#00338D" data-score="27" id="afc-wc1-w">
                        <div class="logo-box" style="background:#00338D;">BUF</div>
                        <div class="team-info"><span class="name">Bills</span><span class="seed">#6</span></div>
                        <span class="score">27</span>
                    </div>
                    <div class="team-slot eliminated real-loser" id="afc-wc1-l">
                        <div class="logo-box" style="background:#006778;">JAX</div>
                        <div class="team-info"><span class="name">Jaguars</span><span class="seed">#3</span></div>
                        <span class="score">24</span>
                    </div>
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=OZrEboMLou4" target="_blank">Watch Highlights</a>
                </div>

                <div class="matchup">
                    <div class="game-meta"><span>MON 5:15 PM PT</span><span>ABC</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Texans" data-seed="5" data-color="#03202f" id="afc-wc2-a">
                        <div class="logo-box" style="background:#03202f;">HOU</div>
                        <div class="team-info"><span class="name">Texans</span><span class="seed">#5</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Steelers" data-seed="4" data-color="#FFB612; color:black" id="afc-wc2-b">
                        <div class="logo-box" style="background:#FFB612; color:black;">PIT</div>
                        <div class="team-info"><span class="name">Steelers</span><span class="seed">#4</span></div>
                    </div>
                </div>

                <div class="matchup">
                    <div class="game-meta"><span>SUN 5:15 PM PT</span><span>NBC</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Chargers" data-seed="7" data-color="#0080C6" id="afc-wc3-a">
                        <div class="logo-box" style="background:#0080C6;">LAC</div>
                        <div class="team-info"><span class="name">Chargers</span><span class="seed">#7</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Patriots" data-seed="2" data-color="#002244" id="afc-wc3-b">
                        <div class="logo-box" style="background:#002244;">NE</div>
                        <div class="team-info"><span class="name">Patriots</span><span class="seed">#2</span></div>
                    </div>
                </div>
            </div>

            <div class="column col-divisional" id="afc-divisional-col">
                <div class="round-header">AFC Divisional</div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 17/18</span><span>CBS</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Broncos" data-seed="1" data-color="#FB4F14" id="afc-div1-home">
                        <div class="logo-box" style="background:#FB4F14;">DEN</div>
                        <div class="team-info"><span class="name">Broncos</span><span class="seed">#1</span></div>
                    </div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="seed1-opponent" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 17/18</span><span>TBD</span></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="other-game" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="other-game" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <div class="column col-conference" id="afc-conf-col">
                <div class="round-header">AFC Championship</div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 25 - 12:00 PM PT</span><span>CBS</span></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <!-- ================= CENTER STAGE ================= -->
            <div class="column sb-column" id="sb-col">
                <div class="round-header">Super Bowl LX</div>
                <div class="sb-logo-container">
                    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/b/b0/Super_Bowl_LX_Logo.svg/330px-Super_Bowl_LX_Logo.svg.png" alt="SB LX" class="sb-img">
                </div>
                <div class="matchup" style="width: 280px; text-align: center;">
                    <div class="game-meta" style="justify-content: center;"><span>FEB 8 - 3:30 PM PT</span></div>
                    <!-- Updated: Left is AFC, Right is NFC -->
                    <div class="team-slot empty-slot" data-target-conf="AFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div style="font-size:0.8em; color:#666; margin: 5px;">VS</div>
                    <div class="team-slot empty-slot" data-target-conf="NFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="round-header" style="margin-top: 40px; color: var(--gold-shine);">Super Bowl Champion</div>
                <div id="sb-champion-slot" class="team-slot empty-slot ultimate-slot" data-target-conf="any" ondrop="drop(event)" ondragover="allowDrop(event)" style="width: 280px;"></div>
            </div>

            <!-- ================= NFC SIDE ================= -->
            <div class="column col-conference" id="nfc-conf-col">
                <div class="round-header">NFC Championship</div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 25 - 3:30 PM PT</span><span>FOX</span></div>
                    <div class="team-slot empty-slot" data-target-conf="NFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="NFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <div class="column col-divisional" id="nfc-divisional-col">
                <div class="round-header">NFC Divisional</div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 17/18</span><span>FOX</span></div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Seahawks" data-seed="1" data-color="#002244" id="nfc-div1-home">
                        <div class="logo-box" style="background:#002244;">SEA</div>
                        <div class="team-info"><span class="name">Seahawks</span><span class="seed">#1</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="49ers" data-seed="6" data-color="#AA0000" id="nfc-div1-visitor">
                        <div class="logo-box" style="background:#AA0000;">SF</div>
                        <div class="team-info"><span class="name">49ers</span><span class="seed">#6</span></div>
                    </div>
                </div>
                <div class="matchup">
                    <div class="game-meta"><span>Jan 17/18</span><span>TBD</span></div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Bears" data-seed="2" data-color="#C83803" id="nfc-div2-home">
                        <div class="logo-box" style="background:#C83803;">CHI</div>
                        <div class="team-info"><span class="name">Bears</span><span class="seed">#2</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Rams" data-seed="5" data-color="#003594" id="nfc-div2-visitor">
                        <div class="logo-box" style="background:#003594;">LAR</div>
                        <div class="team-info"><span class="name">Rams</span><span class="seed">#5</span></div>
                    </div>
                </div>
            </div>

            <div class="column" id="nfc-wc-col">
                <div class="round-header">NFC Wild Card</div>
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=YPS3tHwvwR8">
                    <div class="game-meta"><span>FINAL</span><span>FOX</span></div>
                    <div class="team-slot winner manual-winner" draggable="true" data-conf="NFC" data-team="49ers" data-seed="6" data-color="#AA0000" id="nfc-wc1-a" data-score="24">
                        <div class="logo-box" style="background:#AA0000;">SF</div>
                        <div class="team-info"><span class="name">49ers</span><span class="seed">#6</span></div>
                        <span class="score">24</span>
                    </div>
                    <div class="team-slot eliminated real-loser" draggable="true" data-conf="NFC" data-team="Eagles" data-seed="3" data-color="#004C54" id="nfc-wc1-b" data-score="21">
                        <div class="logo-box" style="background:#004C54;">PHI</div>
                        <div class="team-info"><span class="name">Eagles</span><span class="seed">#3</span></div>
                        <span class="score">21</span>
                    </div>
                    <a class="highlight-btn disabled" href="#" target="_blank">Awaiting Highlights</a>
                </div>
                
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=Rh9xD2eoJcY">
                    <div class="game-meta"><span>FINAL</span></div>
                    <div class="team-slot winner manual-winner" draggable="true" data-conf="NFC" data-team="Rams" data-seed="5" data-color="#003594" data-score="34" id="nfc-wc2-w">
                        <div class="logo-box" style="background:#003594;">LAR</div>
                        <div class="team-info"><span class="name">Rams</span><span class="seed">#5</span></div>
                        <span class="score">34</span>
                    </div>
                    <div class="team-slot eliminated real-loser" id="nfc-wc2-l">
                        <div class="logo-box" style="background:#0085CA;">CAR</div>
                        <div class="team-info"><span class="name">Panthers</span><span class="seed">#4</span></div>
                        <span class="score">31</span>
                    </div>
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=Rh9xD2eoJcY" target="_blank">Watch Highlights</a>
                </div>
                
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=tnX85oZOV40">
                    <div class="game-meta"><span>FINAL</span></div>
                    <div class="team-slot eliminated real-loser" id="nfc-wc3-l">
                        <div class="logo-box" style="background:#203731;">GB</div>
                        <div class="team-info"><span class="name">Packers</span><span class="seed">#7</span></div>
                        <span class="score">27</span>
                    </div>
                    <div class="team-slot winner manual-winner" draggable="true" data-conf="NFC" data-team="Bears" data-seed="2" data-color="#C83803" data-score="31" id="nfc-wc3-w">
                        <div class="logo-box" style="background:#C83803;">CHI</div>
                        <div class="team-info"><span class="name">Bears</span><span class="seed">#2</span></div>
                        <span class="score">31</span>
                    </div>
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=tnX85oZOV40" target="_blank">Watch Highlights</a>
                </div>
            </div>
        </div>
    </div>

    <div class="confetti-container" id="confetti-box"></div>

    <script>
        let draggedItem = null;
        let wasDropped = false; 
        let dragClone = null;
        let touchOffsetX = 0;
        let touchOffsetY = 0;

        function scrollToId(id) {
            const container = document.getElementById('bracket-container');
            const el = document.getElementById(id);
            if (container && el) {
                const containerRect = container.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                const scrollLeft = container.scrollLeft + (elRect.left - containerRect.left) - (container.clientWidth / 2) + (el.offsetWidth / 2);
                container.scrollTo({ left: scrollLeft, behavior: 'smooth' });
            }
        }

        function scrollBracket(direction) {
            const container = document.getElementById('bracket-container');
            container.scrollBy({ left: 300 * direction, behavior: 'smooth' });
        }

        function saveBracket() {
            const name = prompt("Enter your name");
            if (!name) return;
            const btn = document.getElementById('save-bracket-btn');
            const originalText = btn.innerText;
            btn.innerText = 'Generating...';
            document.body.classList.add('taking-screenshot');
            const customHeader = document.createElement('div');
            customHeader.id = 'temp-custom-header';
            customHeader.innerHTML = `<h1>${name}'s NFL Bracket</h1>`;
            document.body.prepend(customHeader);
            
            setTimeout(() => {
                html2canvas(document.body, { backgroundColor: '#111', scale: 2, useCORS: true, windowWidth: 1600,
                    ignoreElements: (element) => element.classList.contains('highlight-btn') || element.classList.contains('mobile-nav') || element.id === 'save-bracket-btn'
                }).then(canvas => {
                    canvas.toBlob(blob => {
                        if (navigator.canShare && navigator.canShare({ files: [new File([blob], "bracket.png", {type: "image/png"})] })) {
                            const file = new File([blob], `${name.replace(/\s+/g, '_')}_nfl_bracket.png`, {type: "image/png"});
                            navigator.share({ files: [file], title: 'My NFL Bracket', text: 'Check out my NFL Playoff Bracket!' });
                        } else if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
                            const modal = document.getElementById('save-modal');
                            document.getElementById('save-modal-img').src = canvas.toDataURL();
                            modal.style.display = 'flex';
                        } else {
                            const link = document.createElement('a');
                            link.download = `${name.replace(/\s+/g, '_')}_nfl_bracket.png`;
                            link.href = canvas.toDataURL();
                            link.click();
                        }
                    });
                    document.body.classList.remove('taking-screenshot');
                    customHeader.remove();
                    btn.innerText = originalText;
                });
            }, 100);
        }

        function handleDragStart(e) {
            draggedItem = this;
            wasDropped = false; 
            e.dataTransfer.effectAllowed = 'copy';
            setTimeout(() => this.style.opacity = '0.5', 0);
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            document.querySelectorAll('.drop-target-active').forEach(el => el.classList.remove('drop-target-active'));
            if (!wasDropped && draggedItem && draggedItem.hasAttribute('ondrop') && !draggedItem.classList.contains('empty-slot')) {
                clearSlot(draggedItem);
                updateBracketVisuals();
            }
            draggedItem = null;
        }

        function handleTouchStart(e) {
            const slot = e.target.closest('.team-slot');
            if (!slot || slot.getAttribute('draggable') !== 'true') return;
            draggedItem = slot;
            const rect = slot.getBoundingClientRect();
            const touch = e.touches[0];
            touchOffsetX = touch.clientX - rect.left;
            touchOffsetY = touch.clientY - rect.top;
            dragClone = slot.cloneNode(true);
            dragClone.classList.add('drag-clone');
            dragClone.style.width = rect.width + 'px';
            updateClonePosition(touch.clientX, touch.clientY);
            document.body.appendChild(dragClone);
            slot.style.opacity = '0.5';
            e.preventDefault();
        }

        function handleTouchMove(e) {
            if (!draggedItem || !dragClone) return;
            e.preventDefault();
            const touch = e.touches[0];
            updateClonePosition(touch.clientX, touch.clientY);
            dragClone.style.display = 'none';
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            dragClone.style.display = 'block';
            if (!elementBelow) return;
            const targetSlot = elementBelow.closest('.team-slot');
            document.querySelectorAll('.drop-target-active').forEach(el => el.classList.remove('drop-target-active'));
            if (targetSlot && targetSlot !== draggedItem) {
                let targetConf = targetSlot.getAttribute('data-target-conf');
                let itemConf = draggedItem.getAttribute('data-conf');
                if (targetConf === itemConf || targetConf === 'any') targetSlot.classList.add('drop-target-active');
            }
        }

        function handleTouchEnd(e) {
            if (!draggedItem) return;
            const touch = e.changedTouches[0];
            if (dragClone) dragClone.remove();
            dragClone = null;
            draggedItem.style.opacity = '1';
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            const targetSlot = elementBelow ? elementBelow.closest('.team-slot') : null;
            if (targetSlot) processDrop(targetSlot);
            else if (draggedItem.hasAttribute('ondrop') && !draggedItem.classList.contains('empty-slot')) {
                clearSlot(draggedItem);
                updateBracketVisuals();
            }
            draggedItem = null;
        }

        function updateClonePosition(x, y) {
            if (dragClone) {
                dragClone.style.left = (x - touchOffsetX) + 'px';
                dragClone.style.top = (y - touchOffsetY) + 'px';
            }
        }

        function setupDraggableItems() {
            document.querySelectorAll('[draggable="true"]').forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd);
            });
        }

        function allowDrop(e) {
            e.preventDefault();
            const targetSlot = e.target.closest('.team-slot');
            if (targetSlot && draggedItem) {
                const targetConf = targetSlot.getAttribute('data-target-conf');
                const itemConf = draggedItem.getAttribute('data-conf');
                if (targetConf === itemConf || targetConf === 'any') targetSlot.classList.add('drop-target-active');
            }
        }

        function drop(e) {
            e.preventDefault();
            wasDropped = true; 
            processDrop(e.target.closest('.team-slot'));
        }

        function processDrop(targetSlot) {
            if (!targetSlot || !draggedItem) return;
            targetSlot.classList.remove('drop-target-active');
            const itemConf = draggedItem.getAttribute('data-conf');
            const targetConf = targetSlot.getAttribute('data-target-conf');
            if (targetConf !== itemConf && targetConf !== 'any') return;

            const targetColumn = targetSlot.closest('.column');
            
            // SUPER BOWL CHAMPION LOCK
            if (targetSlot.id === 'sb-champion-slot') {
                const slots = targetColumn.querySelectorAll('.matchup .team-slot');
                if (Array.from(slots).filter(s => !s.classList.contains('empty-slot')).length < 2) {
                    alert("Pick both Super Bowl teams first!");
                    return;
                }
            }

            // CONFERENCE DECOUPLED PREVIOUS ROUND CHECK
            const targetColId = targetColumn.id;
            let prevRoundCols = [];
            if (targetColId === 'afc-conf-col') prevRoundCols = ['afc-divisional-col'];
            else if (targetColId === 'nfc-conf-col') prevRoundCols = ['nfc-divisional-col'];
            else if (targetColId === 'sb-col' && targetSlot.id !== 'sb-champion-slot') {
                // If dropping into the SB matchup, only check the relevant conference
                prevRoundCols = (targetConf === 'AFC' || itemConf === 'AFC') ? ['afc-conf-col'] : ['nfc-conf-col'];
            }

            for (let id of prevRoundCols) {
                if (document.getElementById(id).querySelectorAll('.empty-slot').length > 0) {
                    alert("Fill out the previous round for this conference first!");
                    return; 
                }
            }

            // RESEEDING & DUPLICATE CHECKS
            if (targetColumn.className.includes('col-divisional') && draggedItem.getAttribute('data-seed') === '1') return;
            const role = targetSlot.getAttribute('data-role');
            if ((role === 'seed1-opponent' || role === 'other-game') && !validateDivisionalDrop(targetSlot, draggedItem, targetColumn)) return;

            const teamData = {
                name: draggedItem.querySelector('.name').innerText,
                seed: draggedItem.querySelector('.seed').innerText,
                color: draggedItem.getAttribute('data-color'),
                logo: draggedItem.querySelector('.logo-box').innerText,
                dataName: draggedItem.getAttribute('data-team'),
                conf: draggedItem.getAttribute('data-conf'),
                seedNum: draggedItem.getAttribute('data-seed')
            };

            const existing = Array.from(targetColumn.querySelectorAll('.team-slot')).find(s => s.getAttribute('data-team') === teamData.dataName);
            fillSlot(targetSlot, teamData);
            if (targetSlot.id !== 'sb-champion-slot' && existing && existing !== targetSlot) clearSlot(existing);
            updateBracketVisuals();
        }

        function validateDivisionalDrop(targetSlot, item, column) {
            const role = targetSlot.getAttribute('data-role');
            const newSeed = parseInt(item.getAttribute('data-seed'));
            const placed = Array.from(column.querySelectorAll('.team-slot')).filter(s => {
                const t = s.getAttribute('data-team');
                return t && t !== 'Broncos' && t !== 'Seahawks' && t !== item.getAttribute('data-team');
            }).map(s => ({ seed: parseInt(s.getAttribute('data-seed')), role: s.getAttribute('data-role'), name: s.querySelector('.name').innerText }));

            if (role === 'other-game') {
                const op = placed.find(t => t.role === 'seed1-opponent');
                if (op && newSeed > op.seed) { alert(`RESEEDING MISTAKE!\n\nThe lowest seed must play the #1 Seed.`); return false; }
            } else if (role === 'seed1-opponent') {
                const ot = placed.find(t => t.role === 'other-game');
                if (ot && newSeed < ot.seed) { alert(`RESEEDING MISTAKE!\n\nThe lowest seed must play the #1 Seed.`); return false; }
            }
            return true;
        }

        function fillSlot(slot, data) {
            slot.innerHTML = `<div class="logo-box" style="background:${data.color};">${data.logo}</div><div class="team-info"><span class="name">${data.name}</span><span class="seed">${data.seed}</span></div>`;
            slot.className = 'team-slot';
            slot.setAttribute('draggable', 'true');
            slot.setAttribute('data-conf', data.conf);
            slot.setAttribute('data-color', data.color);
            slot.setAttribute('data-team', data.dataName);
            slot.setAttribute('data-seed', data.seedNum);
            
            if (slot.id === 'sb-champion-slot') {
                slot.classList.add('ultimate-champion');
                throwConfetti();
                document.getElementById('save-bracket-btn').style.display = 'flex';
            } else setupDraggableItems();
        }

        function clearSlot(slot) {
            if (slot.id === 'sb-champion-slot') document.getElementById('save-bracket-btn').style.display = 'none';
            slot.innerHTML = '';
            slot.className = 'team-slot empty-slot';
            slot.removeAttribute('draggable');
            slot.removeAttribute('data-team');
            slot.removeAttribute('data-seed');
            slot.removeAttribute('data-color');
        }

        function updateBracketVisuals() {
            const all = document.querySelectorAll('.team-slot[data-team]');
            all.forEach(s => { if (!s.classList.contains('real-loser') && !s.classList.contains('manual-winner')) { s.classList.remove('winner', 'eliminated'); s.style.borderLeftColor = ''; s.style.background = ''; }});
            all.forEach(slot => {
                const team = slot.getAttribute('data-team');
                const col = slot.closest('.column');
                let next = '';
                if(col.className === 'column') next = 'col-divisional';
                else if(col.className.includes('col-divisional')) next = 'col-conference';
                else if(col.className.includes('col-conference')) next = 'sb-column';
                
                let isWin = next ? document.querySelectorAll('.' + next + ' .team-slot[data-team="' + team + '"]').length > 0 : false;
                if (col.classList.contains('sb-column') && slot.id !== 'sb-champion-slot') {
                    if (document.getElementById('sb-champion-slot').getAttribute('data-team') === team) isWin = true;
                }

                if (isWin || slot.classList.contains('manual-winner')) {
                    slot.classList.add('winner');
                    const color = slot.getAttribute('data-color');
                    if (color) { slot.style.borderLeftColor = color; slot.style.background = `linear-gradient(90deg, #252525, ${color}33)`; }
                    slot.closest('.matchup').querySelectorAll('.team-slot').forEach(opp => { if (opp !== slot) opp.classList.add('eliminated'); });
                }
            });
        }

        function throwConfetti() {
            const box = document.getElementById('confetti-box');
            const colors = ['#FFD700', '#ff0000', '#0000ff', '#ffffff'];
            for (let i = 0; i < 100; i++) {
                const c = document.createElement('div');
                c.className = 'confetti-piece';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                c.style.animation = `fall ${Math.random() * 3 + 2}s linear ${Math.random() * 2}s forwards`;
                box.appendChild(c);
            }
        }

        async function initLiveScoring() {
            const API = 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard';
            async function fetchAndRender() {
                try {
                    const res = await fetch(API);
                    const data = await res.json();
                    data.events.forEach(e => {
                        const comp = e.competitions[0];
                        const state = e.status.type.state;
                        comp.competitors.forEach(c => {
                            const name = c.team.name;
                            const score = c.score;
                            document.querySelectorAll(`.team-slot[data-team="${name}"]`).forEach(slot => {
                                const matchup = slot.closest('.matchup');
                                const apiOpp = comp.competitors.find(x => x.id !== c.id).team.name;
                                const brOpp = Array.from(matchup.querySelectorAll('.team-slot')).find(s => s !== slot)?.getAttribute('data-team');
                                if (brOpp !== apiOpp) return;
                                if (state !== 'pre') {
                                    let sEl = slot.querySelector('.score');
                                    if (!sEl) { sEl = document.createElement('span'); sEl.className = 'score'; slot.appendChild(sEl); }
                                    sEl.textContent = score;
                                    const meta = matchup.querySelector('.game-meta span:first-child');
                                    meta.textContent = e.status.type.detail.toUpperCase();
                                    if (state === 'in') meta.classList.add('live-text');
                                }
                            });
                        });
                    });
                } catch (err) {}
            }
            fetchAndRender(); setInterval(fetchAndRender, 60000);
        }

        initLiveScoring();
        updateBracketVisuals();
        setupDraggableItems();
        
        const sheet = document.createElement("style");
        sheet.innerText = `@keyframes fall { 0% { top: -20px; opacity: 1; transform: rotate(0deg); } 100% { top: 100vh; opacity: 0; transform: rotate(720deg); } }`;
        document.head.appendChild(sheet);
    </script>
</body>
</html>
