<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NFL Playoffs 2025 Season Bracket</title>
    <!-- Add html2canvas library for screenshot functionality -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --nfl-blue: #013369;
            --gold-shine: #FFD700;
            --super-gold: #fff27e;
            --bg-card: rgba(30,30,30,0.95);
            --bg-slot: #252525;
            --dim-alpha: 0.3;
        }

        /* NEW LAYOUT: Fixed header, scrollable body */
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #111;
            background-image: 
                radial-gradient(circle at center, transparent 0%, #000 100%),
                repeating-linear-gradient(0deg, transparent 0px, transparent 1px, rgba(255,255,255,0.03) 2px),
                linear-gradient(to bottom, #1e2b1e, #000);
            color: white;
            margin: 0;
            padding: 0;
            height: 100vh; /* Full viewport height */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent body scroll */
            user-select: none;
        }

        /* Fixed Header Container */
        .header-container {
            flex: 0 0 auto;
            /* Default Desktop Padding */
            padding: 10px 20px 0 20px;
            background: rgba(17, 17, 17, 0.9);
            backdrop-filter: blur(5px);
            z-index: 50;
            text-align: center;
            border-bottom: 1px solid #333;
        }

        h1 { 
            font-size: 1.8em; 
            letter-spacing: 2px; 
            margin: 5px 0; 
            text-shadow: 0 4px 10px rgba(0,0,0,0.8); 
            text-transform: uppercase;
        }
        
        .subtitle { 
            color: #aaa; 
            margin-bottom: 10px; 
            font-size: 0.9em; 
            font-weight: 400; 
        }

        .sb-details-bar {
            color: var(--gold-shine);
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            background: linear-gradient(90deg, transparent 0%, rgba(255, 215, 0, 0.1) 50%, transparent 100%);
            padding: 8px 0;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            letter-spacing: 1px;
        }

        /* Helpers for responsive text breaks */
        .mobile-break { display: none; }
        .desktop-sep { display: inline; }

        /* Scrollable Bracket Area */
        .bracket-wrapper {
            flex: 1 1 auto;
            display: flex;
            align-items: center; /* Center vertically if space allows */
            gap: 20px;
            overflow: auto; /* Handle both X and Y scroll here */
            padding: 20px;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
            width: 100%; 
        }

        /* Force min-width so scrolling works, but allow centering */
        .bracket-content-sizer {
            display: flex;
            gap: 20px;
            min-width: 1400px; /* Ensure bracket doesn't collapse */
            margin: 0 auto;
        }

        .column {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            gap: 40px;
            min-width: 240px;
            scroll-snap-align: center;
            scroll-snap-stop: always;
        }

        .col-divisional { gap: 150px; }
        .col-conference { gap: 300px; }
        .sb-column { justify-content: center; align-items: center; }

        .round-header {
            text-transform: uppercase; color: #888; font-size: 0.8em; font-weight: bold; margin-bottom: 10px; text-align: center;
        }

        .matchup {
            background: var(--bg-card); border: 1px solid #444; border-radius: 8px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); position: relative;
        }

        .game-meta {
            font-size: 0.7em; color: #aaa; margin-bottom: 8px; display: flex; justify-content: space-between; border-bottom: 1px solid #444; padding-bottom: 4px;
        }

        .live-text {
            color: #ff4444;
            font-weight: bold;
            animation: pulseLive 2s infinite;
        }

        @keyframes pulseLive {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .highlight-btn {
            background: #333; 
            color: #aaa; 
            border: 1px solid #555; 
            border-radius: 4px; 
            padding: 4px 8px; 
            font-size: 0.8em; 
            cursor: pointer; 
            text-decoration: none; 
            /* CENTERED BUTTON STYLES */
            display: block; 
            width: fit-content;
            margin: 8px auto 0 auto;
            transition: 0.2s;
        }
        .highlight-btn:hover { background: #555; color: white; border-color: #777; }

        /* DISABLED STATE FOR AWAITING HIGHLIGHTS */
        .highlight-btn.disabled {
            background: #222;
            color: #555;
            border-color: #333;
            cursor: default;
            pointer-events: none;
            font-style: italic;
        }

        .team-slot {
            display: flex; align-items: center; padding: 6px; margin: 4px 0; background: var(--bg-slot); border-radius: 4px; border: 2px solid transparent; cursor: grab; transition: all 0.2s;
            border-left: 4px solid #444;
            position: relative;
        }
        .team-slot:active { cursor: grabbing; }
        
        .drop-target-active {
            border-color: var(--gold-shine); background: #333; box-shadow: 0 0 10px var(--gold-shine);
        }

        .empty-slot {
            background: #1a1a1a; border: 1px dashed #555; color: #555; justify-content: center; height: 35px; flex-direction: column; font-size: 0.7em; border-left: 1px dashed #555;
        }

        .logo-box {
            width: 28px; height: 28px; border-radius: 50%; margin-right: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.6em; color: white; text-shadow: 1px 1px 2px black;
        }

        .team-info { flex-grow: 1; text-align: left; }
        .name { font-weight: bold; font-size: 0.9em; display: block;}
        .seed { font-size: 0.7em; color: #999; }
        .score { font-weight: bold; font-size: 1.1em; }

        /* PREDICTION SCORE INPUT */
        .prediction-input {
            width: 35px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--gold-shine);
            color: var(--gold-shine);
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
            padding: 2px;
            font-size: 0.9em;
            margin-left: 5px;
            /* Mobile touch friendly */
            height: 24px;
        }
        .prediction-input:focus {
            outline: none;
            background: rgba(255, 215, 0, 0.1);
        }
        /* Hide spin buttons */
        .prediction-input::-webkit-outer-spin-button,
        .prediction-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* HIDE PREDICTION INPUTS WHEN BRACKET IS COMPLETE */
        body.bracket-complete .prediction-input {
            display: none !important;
        }

        .winner { 
            /* MODIFIED: Removed !important to allow JS to set specific team color */
            border-left: 4px solid var(--gold-shine); 
            background: linear-gradient(90deg, #252525, #2f2f20); 
            opacity: 1 !important;
            filter: grayscale(0%) !important;
        }
        
        .eliminated { 
            opacity: var(--dim-alpha) !important; 
            filter: grayscale(100%) !important; 
            border-left: 4px solid #333 !important;
        }
        
        .real-loser {
            pointer-events: none;
            opacity: 0.2 !important;
        }
        
        .sb-logo-container {
            display: flex; justify-content: center; align-items: center; margin-bottom: 20px;
        }
        .sb-img {
            height: 100px;
            width: auto;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.8));
        }

        .ultimate-slot { height: 60px; font-size: 1.2em; border-width: 3px; }

        .ultimate-champion {
            background: linear-gradient(90deg, #4f4f20, #8f7f10) !important;
            border-left: 4px solid var(--super-gold) !important;
            border-color: var(--super-gold) !important;
            box-shadow: 0 0 30px var(--super-gold), inset 0 0 20px var(--gold-shine) !important;
            animation: championPulse 1.5s infinite alternate;
        }

        @keyframes championPulse {
            0% { box-shadow: 0 0 20px var(--super-gold); }
            100% { box-shadow: 0 0 50px var(--super-gold), 0 0 100px var(--gold-shine); filter: brightness(1.2); }
        }

        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .confetti-piece { position: absolute; width: 10px; height: 20px; background: #ffd700; top: -20px; opacity: 0; }
        
        .drag-clone {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.9;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            transform: scale(1.05);
        }

        /* NEW: Save Bracket Button */
        .save-btn {
            position: fixed;
            bottom: 90px; /* Above nav bar */
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold-shine);
            color: black;
            border: 2px solid #fff;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            z-index: 10001;
            display: none; /* Hidden until complete */
            cursor: pointer;
            transition: all 0.2s;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .save-btn:active { transform: translateX(-50%) scale(0.95); }

        /* HIDE SAVE BUTTON ON DESKTOP */
        @media (min-width: 1025px) {
            .save-btn { display: none !important; }
        }

        @keyframes popIn {
            from { bottom: -50px; opacity: 0; }
            to { bottom: 90px; opacity: 1; }
        }

        /* Styles for screenshot mode */
        .taking-screenshot .mobile-nav, 
        .taking-screenshot .highlight-btn, 
        .taking-screenshot .save-btn,
        .taking-screenshot .header-container { /* Hide original header */
            display: none !important; 
        }

        /* TEMP CUSTOM HEADER FOR SCREENSHOT */
        #temp-custom-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            text-align: center;
            padding: 30px 0 10px 0;
            background: #111;
            z-index: 9999;
        }
        #temp-custom-header h1 {
            font-size: 3em;
            color: white;
            text-transform: uppercase;
            margin: 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.8);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* NEW: Enhanced Mobile Navigation Controls */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.9);
            border: 1px solid #555;
            border-radius: 50px;
            padding: 6px 10px;
            z-index: 10000;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.9);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }

        .mobile-btn {
            background: #333;
            color: #ddd;
            border: 1px solid #555;
            border-radius: 25px;
            /* BIGGER BUTTONS */
            padding: 10px 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
        }

        .mobile-btn:active {
            background: var(--gold-shine);
            color: black;
            border-color: var(--gold-shine);
            transform: scale(0.95);
        }
        
        .mobile-btn-primary {
            background: #444;
            color: white;
            border-color: #777;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        /* MOBILE SPECIFIC OPTIMIZATIONS */
        @media (max-width: 1024px) {
            .mobile-nav { display: flex; }
            
            /* COMPACT HEADER */
            .header-container {
                /* Safe Area padding + minimized spacing */
                padding: max(2px, env(safe-area-inset-top)) 10px 0 10px;
            }
            h1 { 
                font-size: 1.1em; /* Smaller title */
                margin: 0; 
                display: block; 
                visibility: visible;
                line-height: 1.1;
            }
            
            /* SUBTITLE VISIBLE ON MOBILE AGAIN */
            .subtitle { 
                font-size: 0.7em; 
                margin-bottom: 2px; 
                display: block; 
            } 
            
            .sb-details-bar { 
                font-size: 0.6em; 
                padding: 3px 0; 
                margin: 2px 0 2px 0;
                line-height: 1.2;
                border-top: 1px solid rgba(255, 215, 0, 0.1);
                border-bottom: 1px solid rgba(255, 215, 0, 0.1);
            }
            
            .mobile-break { display: block; }
            .desktop-sep { display: none; }

            .bracket-wrapper {
                align-items: stretch; 
                padding: 0 5px; 
                height: 100%;
                gap: 5px; 
                /* NO VERTICAL SCROLLING ON MOBILE */
                overflow-y: hidden;
            }
            
            .bracket-content-sizer {
                height: 100%;
                align-items: flex-start; /* Start from top */
                min-width: auto; 
                gap: 5px;
                /* EXTRA SPACE ON RIGHT FOR SCROLLING ACCESS */
                padding-right: 25px;
            }
            
            /* COMPRESS LAYOUT TO FIT PHONE SCREENS WITHOUT SCROLLING */
            /* UPDATED: Fit ~2 columns on screen */
            .column {
                gap: 8px; /* TIGHT GAP between games, no space-evenly spreading */
                justify-content: flex-start; /* PACK TO TOP */
                padding-top: 5px;
                padding-bottom: 60px; /* Space for nav bar */
                height: 100%;
                min-width: 45vw; /* Show ~2 columns */
                /* CENTER SNAP for SB alignment */
                scroll-snap-align: center; 
            }
            
            .col-divisional, .col-conference {
                gap: 20px; /* Let space-evenly handle it */
            }

            .matchup {
                padding: 4px; /* Very tight padding */
                margin-bottom: 0;
                border-radius: 6px;
            }

            .round-header {
                margin-bottom: 3px;
                font-size: 0.7em;
                color: #666;
            }
            
            /* Tighten Slots */
            .team-slot {
                padding: 2px 4px;
                min-height: 28px;
                margin: 2px 0;
            }
            
            .logo-box {
                width: 16px; height: 16px; font-size: 0.5em; margin-right: 4px; 
            }
            .name { font-size: 0.75em; } 
            .seed { font-size: 0.65em; }
            .score { font-size: 0.8em; }
            
            /* Prediction input mobile sizing */
            .prediction-input {
                width: 30px;
                height: 22px;
                font-size: 0.8em;
                margin-left: 2px;
            }
            
            .game-meta { 
                font-size: 0.6em; 
                margin-bottom: 2px; 
                padding-bottom: 2px;
            }
            
            /* Make highlights button smaller */
            .highlight-btn {
                font-size: 0.65em;
                padding: 2px 6px;
                margin-top: 2px;
            }
            
            .sb-img { height: 50px; }
            .ultimate-slot { height: 40px; }
        }
    </style>
</head>
<body>

    <div class="header-container">
        <h1>NFL Playoffs 2025 Season</h1>
        <p class="subtitle">Build your NFL bracket.</p>
        <div class="sb-details-bar">
            Super Bowl LX • Feb 8, 3:30 PM PT<span class="desktop-sep"> • </span><br class="mobile-break">Levi's Stadium, Santa Clara, CA
        </div>
    </div>

    <!-- Mobile Navigation Bar -->
    <div class="mobile-nav">
        <button class="mobile-btn" onclick="scrollToId('afc-wc-col')">AFC</button>
        <button class="mobile-btn" onclick="scrollBracket(-1)">&lt;</button>
        <button class="mobile-btn mobile-btn-primary" onclick="scrollToId('sb-col')">SB</button>
        <button class="mobile-btn" onclick="scrollBracket(1)">&gt;</button>
        <button class="mobile-btn" onclick="scrollToId('nfc-wc-col')">NFC</button>
    </div>

    <!-- NEW: Save Bracket Button -->
    <button id="save-bracket-btn" class="save-btn" onclick="saveBracket()">
        Save Bracket
    </button>

    <div class="bracket-wrapper" id="bracket-container">
        <!-- Wrapper Div to ensure width -->
        <div class="bracket-content-sizer">
            <!-- ================= AFC SIDE ================= -->
            <div class="column" id="afc-wc-col">
                <div class="round-header">AFC Wild Card</div>
                
                <!-- Bills vs Jags (FINAL) -->
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=OZrEboMLou4">
                    <div class="game-meta"><span>FINAL</span><span>CBS</span></div>
                    <div class="team-slot winner" draggable="true" data-conf="AFC" data-team="Bills" data-seed="6" data-color="#00338D" data-score="27" id="afc-wc1-w">
                        <div class="logo-box" style="background:#00338D;">BUF</div>
                        <div class="team-info"><span class="name">Bills</span><span class="seed">#6</span></div>
                        <span class="score">27</span>
                    </div>
                    <div class="team-slot eliminated real-loser" id="afc-wc1-l">
                        <div class="logo-box" style="background:#006778;">JAX</div>
                        <div class="team-info"><span class="name">Jaguars</span><span class="seed">#3</span></div>
                        <span class="score">24</span>
                    </div>
                    <!-- Highlight Button Added Dynamically or Hardcoded -->
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=OZrEboMLou4" target="_blank">Watch Highlights</a>
                </div>

                <!-- Texans vs Steelers (Upcoming) -->
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>MON 5:15 PM PT</span><span>ABC</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Texans" data-seed="5" data-color="#03202f" id="afc-wc2-a">
                        <div class="logo-box" style="background:#03202f;">HOU</div>
                        <div class="team-info"><span class="name">Texans</span><span class="seed">#5</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Steelers" data-seed="4" data-color="#FFB612; color:black" id="afc-wc2-b">
                        <div class="logo-box" style="background:#FFB612; color:black;">PIT</div>
                        <div class="team-info"><span class="name">Steelers</span><span class="seed">#4</span></div>
                    </div>
                </div>

                <!-- Chargers vs Pats (Upcoming) -->
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>SUN 5:15 PM PT</span><span>NBC</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Chargers" data-seed="7" data-color="#0080C6" id="afc-wc3-a">
                        <div class="logo-box" style="background:#0080C6;">LAC</div>
                        <div class="team-info"><span class="name">Chargers</span><span class="seed">#7</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Patriots" data-seed="2" data-color="#002244" id="afc-wc3-b">
                        <div class="logo-box" style="background:#002244;">NE</div>
                        <div class="team-info"><span class="name">Patriots</span><span class="seed">#2</span></div>
                    </div>
                </div>
            </div>

            <div class="column col-divisional" id="afc-divisional-col">
                <div class="round-header">AFC Divisional</div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 17/18</span><span>CBS</span></div>
                    <div class="team-slot" draggable="true" data-conf="AFC" data-team="Broncos" data-seed="1" data-color="#FB4F14" id="afc-div1-home">
                        <div class="logo-box" style="background:#FB4F14;">DEN</div>
                        <div class="team-info"><span class="name">Broncos</span><span class="seed">#1</span></div>
                    </div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="seed1-opponent" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 17/18</span><span>TBD</span></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="other-game" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" data-role="other-game" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <div class="column col-conference" id="afc-conf-col">
                <div class="round-header">AFC Championship</div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 25 - 12:00 PM PT</span><span>CBS</span></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="AFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <!-- ================= CENTER STAGE ================= -->
            <div class="column sb-column" id="sb-col">
                <div class="round-header">Super Bowl LX</div>
                
                <div class="sb-logo-container">
                    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/b/b0/Super_Bowl_LX_Logo.svg/330px-Super_Bowl_LX_Logo.svg.png" alt="SB LX" class="sb-img">
                </div>
                
                <div class="matchup" style="width: 280px; text-align: center;" data-highlight-url="">
                    <div class="game-meta" style="justify-content: center;"><span>FEB 8 - 3:30 PM PT</span></div>
                    <div class="team-slot empty-slot" data-target-conf="any" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div style="font-size:0.8em; color:#666; margin: 5px;">VS</div>
                    <div class="team-slot empty-slot" data-target-conf="any" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>

                <div class="round-header" style="margin-top: 40px; color: var(--gold-shine);">Super Bowl Champion</div>
                <div id="sb-champion-slot" class="team-slot empty-slot ultimate-slot" data-target-conf="any" ondrop="drop(event)" ondragover="allowDrop(event)" style="width: 280px;"></div>
            </div>

            <!-- ================= NFC SIDE ================= -->

            <div class="column col-conference" id="nfc-conf-col">
                <div class="round-header">NFC Championship</div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 25 - 3:30 PM PT</span><span>FOX</span></div>
                    <div class="team-slot empty-slot" data-target-conf="NFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <div class="team-slot empty-slot" data-target-conf="NFC" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>
            </div>

            <div class="column col-divisional" id="nfc-divisional-col">
                <div class="round-header">NFC Divisional</div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 17/18</span><span>FOX</span></div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Seahawks" data-seed="1" data-color="#002244" id="nfc-div1-home">
                        <div class="logo-box" style="background:#002244;">SEA</div>
                        <div class="team-info"><span class="name">Seahawks</span><span class="seed">#1</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="49ers" data-seed="6" data-color="#AA0000" id="nfc-div1-visitor">
                        <div class="logo-box" style="background:#AA0000;">SF</div>
                        <div class="team-info"><span class="name">49ers</span><span class="seed">#6</span></div>
                    </div>
                </div>
                <div class="matchup" data-highlight-url="">
                    <div class="game-meta"><span>Jan 17/18</span><span>TBD</span></div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Bears" data-seed="2" data-color="#C83803" id="nfc-div2-home">
                        <div class="logo-box" style="background:#C83803;">CHI</div>
                        <div class="team-info"><span class="name">Bears</span><span class="seed">#2</span></div>
                    </div>
                    <div class="team-slot" draggable="true" data-conf="NFC" data-team="Rams" data-seed="5" data-color="#003594" id="nfc-div2-visitor">
                        <div class="logo-box" style="background:#003594;">LAR</div>
                        <div class="team-info"><span class="name">Rams</span><span class="seed">#5</span></div>
                    </div>
                </div>
            </div>

            <div class="column" id="nfc-wc-col">
                <div class="round-header">NFC Wild Card</div>
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=YPS3tHwvwR8">
                    <div class="game-meta"><span>FINAL</span><span>FOX</span></div>
                    <div class="team-slot winner" draggable="true" data-conf="NFC" data-team="49ers" data-seed="6" data-color="#AA0000" id="nfc-wc1-a" data-score="24">
                        <div class="logo-box" style="background:#AA0000;">SF</div>
                        <div class="team-info"><span class="name">49ers</span><span class="seed">#6</span></div>
                        <span class="score">24</span>
                    </div>
                    <div class="team-slot eliminated real-loser" draggable="true" data-conf="NFC" data-team="Eagles" data-seed="3" data-color="#004C54" id="nfc-wc1-b" data-score="21">
                        <div class="logo-box" style="background:#004C54;">PHI</div>
                        <div class="team-info"><span class="name">Eagles</span><span class="seed">#3</span></div>
                        <span class="score">21</span>
                    </div>
                    <a class="highlight-btn disabled" href="#" target="_blank">Awaiting Highlights</a>
                </div>
                
                <!-- Rams vs Panthers (FINAL) -->
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=Rh9xD2eoJcY">
                    <div class="game-meta"><span>FINAL</span></div>
                    <div class="team-slot winner" draggable="true" data-conf="NFC" data-team="Rams" data-seed="5" data-color="#003594" data-score="34" id="nfc-wc2-w">
                        <div class="logo-box" style="background:#003594;">LAR</div>
                        <div class="team-info"><span class="name">Rams</span><span class="seed">#5</span></div>
                        <span class="score">34</span>
                    </div>
                    <div class="team-slot eliminated real-loser" id="nfc-wc2-l">
                        <div class="logo-box" style="background:#0085CA;">CAR</div>
                        <div class="team-info"><span class="name">Panthers</span><span class="seed">#4</span></div>
                        <span class="score">31</span>
                    </div>
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=Rh9xD2eoJcY" target="_blank">Watch Highlights</a>
                </div>
                
                <!-- Bears vs Packers (FINAL) -->
                <div class="matchup" data-highlight-url="https://www.youtube.com/watch?v=tnX85oZOV40">
                    <div class="game-meta"><span>FINAL</span></div>
                    <div class="team-slot eliminated real-loser" id="nfc-wc3-l">
                        <div class="logo-box" style="background:#203731;">GB</div>
                        <div class="team-info"><span class="name">Packers</span><span class="seed">#7</span></div>
                        <span class="score">27</span>
                    </div>
                    <div class="team-slot winner" draggable="true" data-conf="NFC" data-team="Bears" data-seed="2" data-color="#C83803" data-score="31" id="nfc-wc3-w">
                        <div class="logo-box" style="background:#C83803;">CHI</div>
                        <div class="team-info"><span class="name">Bears</span><span class="seed">#2</span></div>
                        <span class="score">31</span>
                    </div>
                    <a class="highlight-btn" href="https://www.youtube.com/watch?v=tnX85oZOV40" target="_blank">Watch Highlights</a>
                </div>
            </div>
        </div>
    </div>

    <div class="confetti-container" id="confetti-box"></div>

    <script>
        let draggedItem = null;
        let wasDropped = false; 
        
        let dragClone = null;
        let touchOffsetX = 0;
        let touchOffsetY = 0;

        function scrollToId(id) {
            const container = document.getElementById('bracket-container');
            const el = document.getElementById(id);
            
            if (container && el) {
                // Determine the scroll position to center the element
                const containerRect = container.getBoundingClientRect();
                const elRect = el.getBoundingClientRect();
                
                // Current scroll + distance from left edge - center offset
                const scrollLeft = container.scrollLeft + (elRect.left - containerRect.left) - (container.clientWidth / 2) + (el.offsetWidth / 2);
                
                container.scrollTo({
                    left: scrollLeft,
                    behavior: 'smooth'
                });
            }
        }

        function scrollBracket(direction) {
            const container = document.getElementById('bracket-container');
            const amount = 300; 
            container.scrollBy({ left: amount * direction, behavior: 'smooth' });
        }

        /* NEW: Save Bracket Function */
        function saveBracket() {
            const name = prompt("Enter your name");
            if (!name) return; // Exit if cancelled or empty

            const btn = document.getElementById('save-bracket-btn');
            const originalText = btn.innerText;
            btn.innerText = 'Generating...';
            
            // Add class to body to hide unwanted elements during screenshot
            document.body.classList.add('taking-screenshot');
            
            // Create temporary custom header
            const customHeader = document.createElement('div');
            customHeader.id = 'temp-custom-header';
            customHeader.innerHTML = `<h1>${name}'s NFL Bracket</h1>`;
            document.body.prepend(customHeader);
            
            // Small timeout to allow DOM to update before capture
            setTimeout(() => {
                // Capture the entire body to ensure we get the Title/Header + Bracket
                // We set windowWidth to 1600 to force a "desktop-like" wide render
                // which looks better for a bracket image than a long skinny mobile one.
                html2canvas(document.body, {
                    backgroundColor: '#111', 
                    scale: 2, 
                    useCORS: true,
                    windowWidth: 1600,
                    ignoreElements: (element) => {
                        // Double safeguard to ignore buttons
                        return element.classList.contains('highlight-btn') || 
                               element.classList.contains('mobile-nav') ||
                               element.id === 'save-bracket-btn';
                    }
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${name.replace(/\s+/g, '_')}_nfl_bracket.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                    
                    // Cleanup
                    document.body.classList.remove('taking-screenshot');
                    customHeader.remove();
                    btn.innerText = originalText;
                }).catch(err => {
                    console.error("Screenshot failed:", err);
                    alert("Could not save bracket image.");
                    document.body.classList.remove('taking-screenshot');
                    customHeader.remove();
                    btn.innerText = originalText;
                });
            }, 100);
        }

        function setupDraggableItems() {
            document.querySelectorAll('[draggable="true"]').forEach(item => {
                item.removeEventListener('dragstart', handleDragStart);
                item.removeEventListener('dragend', handleDragEnd);
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                
                item.removeEventListener('touchstart', handleTouchStart);
                item.removeEventListener('touchmove', handleTouchMove);
                item.removeEventListener('touchend', handleTouchEnd);
                item.addEventListener('touchstart', handleTouchStart, { passive: false });
                item.addEventListener('touchmove', handleTouchMove, { passive: false });
                item.addEventListener('touchend', handleTouchEnd);
            });
        }

        function handleDragStart(e) {
            draggedItem = this;
            wasDropped = false; 
            e.dataTransfer.effectAllowed = 'copy';
            setTimeout(() => this.style.opacity = '0.5', 0);
        }

        function handleDragEnd(e) {
            this.style.opacity = '1';
            document.querySelectorAll('.drop-target-active').forEach(el => el.classList.remove('drop-target-active'));

            if (!wasDropped && draggedItem) {
                if (draggedItem.hasAttribute('ondrop') && !draggedItem.classList.contains('empty-slot')) {
                    clearSlot(draggedItem);
                    updateBracketVisuals();
                }
            }
            draggedItem = null;
        }

        function handleTouchStart(e) {
            const slot = e.target.closest('.team-slot');
            if (!slot || slot.getAttribute('draggable') !== 'true') return;

            e.preventDefault();
            draggedItem = slot;

            const rect = slot.getBoundingClientRect();
            const touch = e.touches[0];
            
            touchOffsetX = touch.clientX - rect.left;
            touchOffsetY = touch.clientY - rect.top;

            dragClone = slot.cloneNode(true);
            dragClone.classList.add('drag-clone');
            dragClone.style.width = rect.width + 'px';
            
            updateClonePosition(touch.clientX, touch.clientY);
            
            document.body.appendChild(dragClone);
            slot.style.opacity = '0.5';
        }

        function handleTouchMove(e) {
            if (!draggedItem || !dragClone) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            updateClonePosition(touch.clientX, touch.clientY);

            dragClone.style.display = 'none';
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            dragClone.style.display = 'block';

            if (!elementBelow) return;

            const targetSlot = elementBelow.closest('.team-slot');
            
            document.querySelectorAll('.drop-target-active').forEach(el => el.classList.remove('drop-target-active'));

            if (targetSlot && targetSlot !== draggedItem) {
                let targetConf = targetSlot.getAttribute('data-target-conf');
                let itemConf = draggedItem.getAttribute('data-conf');

                if (targetConf === itemConf || targetConf === 'any') {
                    targetSlot.classList.add('drop-target-active');
                }
            }
        }

        function handleTouchEnd(e) {
            if (!draggedItem) return;

            const touch = e.changedTouches[0];
            
            if (dragClone) dragClone.style.display = 'none';
            const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
            
            if (dragClone) dragClone.remove();
            dragClone = null;
            draggedItem.style.opacity = '1';
            document.querySelectorAll('.drop-target-active').forEach(el => el.classList.remove('drop-target-active'));

            let targetSlot = null;
            if (elementBelow) {
                targetSlot = elementBelow.closest('.team-slot');
            }

            if (targetSlot) {
                processDrop(targetSlot);
            } else {
                if (draggedItem.hasAttribute('ondrop') && !draggedItem.classList.contains('empty-slot')) {
                    clearSlot(draggedItem);
                    updateBracketVisuals();
                }
            }
            
            draggedItem = null;
        }

        function updateClonePosition(x, y) {
            if (dragClone) {
                dragClone.style.left = (x - touchOffsetX) + 'px';
                dragClone.style.top = (y - touchOffsetY) + 'px';
            }
        }

        setupDraggableItems();

        document.addEventListener('dblclick', function(e) {
            const slot = e.target.closest('.team-slot');
            if (slot && slot.hasAttribute('ondrop') && !slot.classList.contains('empty-slot')) {
                clearSlot(slot);
                updateBracketVisuals();
            }
        });

        function allowDrop(e) {
            e.preventDefault();
            if (!draggedItem) return;
            
            let targetSlot = e.target.closest('.team-slot');
            if (!targetSlot) return;

            let targetConf = targetSlot.getAttribute('data-target-conf');
            let itemConf = draggedItem.getAttribute('data-conf');

            if (targetConf === itemConf || targetConf === 'any') {
                targetSlot.classList.add('drop-target-active');
            }
        }

        function drop(e) {
            e.preventDefault();
            wasDropped = true; 
            const targetSlot = e.target.closest('.team-slot');
            processDrop(targetSlot);
        }

        function processDrop(targetSlot) {
            if (!targetSlot || !draggedItem) return;
            
            targetSlot.classList.remove('drop-target-active');

            const itemConf = draggedItem.getAttribute('data-conf');
            const targetConf = targetSlot.getAttribute('data-target-conf');

            // 1. Basic Conference Check (Updated: No Alert)
            if (targetConf !== itemConf && targetConf !== 'any') {
                 if (targetSlot.id !== 'sb-champion-slot') {
                    // Silently fail
                    return;
                 }
            }

            const draggedColumn = draggedItem.closest('.column');
            const targetColumn = targetSlot.closest('.column');

            // NEW: SUPER BOWL PREREQUISITE CHECK
            if (targetSlot.id === 'sb-champion-slot') {
                const sbMatchup = targetColumn.querySelector('.matchup');
                const slots = sbMatchup.querySelectorAll('.team-slot');
                const filled = Array.from(slots).filter(s => !s.classList.contains('empty-slot'));
                
                if (filled.length < 2) {
                    alert("Pick both Super Bowl teams first!");
                    return;
                }
            }

            // NEW: PREVENT LOSER PROGRESSION
            // Only check if moving to a new column (advancing rounds)
            if (targetSlot.id !== 'sb-champion-slot' && draggedColumn !== targetColumn) {
                const sourceMatchup = draggedItem.closest('.matchup');
                if (sourceMatchup) {
                    const slots = Array.from(sourceMatchup.querySelectorAll('.team-slot'));
                    const opponentSlot = slots.find(s => s !== draggedItem);
                    
                    if (opponentSlot && !opponentSlot.classList.contains('empty-slot')) {
                        const opponentName = opponentSlot.getAttribute('data-team');
                        
                        if (opponentName) {
                            const opponentInNextRound = Array.from(targetColumn.querySelectorAll('.team-slot')).find(
                                s => s.getAttribute('data-team') === opponentName
                            );
                            
                            if (opponentInNextRound) {
                                 alert("That doesn't work! These teams played each other.");
                                 return;
                            }
                        }
                    }
                }
            }

            // NEW: STRICT PREVIOUS ROUND CHECK
            const targetColId = targetColumn.id;
            let prevRoundCols = [];

            if (targetColId === 'afc-conf-col') prevRoundCols = ['afc-divisional-col'];
            else if (targetColId === 'nfc-conf-col') prevRoundCols = ['nfc-divisional-col'];
            else if (targetColId === 'sb-col') prevRoundCols = ['afc-conf-col', 'nfc-conf-col'];

            for (let id of prevRoundCols) {
                const col = document.getElementById(id);
                if (col && col.querySelectorAll('.empty-slot').length > 0) {
                    alert("Fill out the previous round first!");
                    return; 
                }
            }

            // 2. #1 Seed Lock Check
            if (draggedColumn === targetColumn && draggedColumn.className.includes('col-divisional')) {
                const seed = draggedItem.getAttribute('data-seed');
                if (seed === '1') {
                     return; 
                }
            }

            // 3. SMART RESEEDING CHECK
            const role = targetSlot.getAttribute('data-role');
            if (role === 'seed1-opponent' || role === 'other-game') {
                if (validateDivisionalDrop(targetSlot, draggedItem, targetColumn) === false) {
                    return; 
                }
            }
            
            // --- DATA EXTRACTION (Fixes disappearing bug) ---
            // Extract data BEFORE clearing anything
            const teamData = {
                name: draggedItem.querySelector('.name').innerText,
                seed: draggedItem.querySelector('.seed').innerText,
                color: draggedItem.getAttribute('data-color'),
                logo: draggedItem.querySelector('.logo-box').innerText,
                dataName: draggedItem.getAttribute('data-team'),
                conf: draggedItem.getAttribute('data-conf'),
                seedNum: draggedItem.getAttribute('data-seed')
            };

            // 4. DUPLICATE CHECK
            const existingInstance = Array.from(targetColumn.querySelectorAll('.team-slot')).find(
                slot => slot.getAttribute('data-team') === teamData.dataName
            );
            
            let shouldClear = true;
            if (targetSlot.id === 'sb-champion-slot') {
                shouldClear = false; 
            }
            
            // 5. EXECUTE MOVE (Order matters: Fill New -> Clear Old)
            
            // A. Fill the new slot with extracted data
            fillSlot(targetSlot, teamData);

            // B. Clear the old instance (if it exists and isn't the target slot)
            // Note: In a reorder within same column, existingInstance IS draggedItem.
            // Since we already filled targetSlot, we safely clear existingInstance now.
            if (shouldClear && existingInstance && existingInstance !== targetSlot) {
                clearSlot(existingInstance);
            }

            // 6. UPDATE HIGHLIGHTS
            updateBracketVisuals();
        }

        function validateDivisionalDrop(targetSlot, item, column) {
            const role = targetSlot.getAttribute('data-role');
            const newSeed = parseInt(item.getAttribute('data-seed'));
            const newTeamName = item.querySelector('.name').innerText;

            const placedTeams = [];
            column.querySelectorAll('.team-slot').forEach(slot => {
                const sTeam = slot.getAttribute('data-team');
                // Ensure we don't count the item we are currently moving if it's already there
                if (sTeam && sTeam !== 'Broncos' && sTeam !== 'Seahawks' && sTeam !== item.getAttribute('data-team')) {
                    placedTeams.push({
                        name: slot.querySelector('.name').innerText,
                        seed: parseInt(slot.getAttribute('data-seed')),
                        role: slot.getAttribute('data-role')
                    });
                }
            });

            if (role === 'other-game') {
                const opponent1 = placedTeams.find(t => t.role === 'seed1-opponent');
                if (opponent1) {
                    if (newSeed > opponent1.seed) {
                        alert(`RESEEDING MISTAKE!\n\nThe ${newTeamName} (#${newSeed}) are a lower seed than the ${opponent1.name} (#${opponent1.seed}).\n\nThe lowest seed must play the #1 Seed.`);
                        return false;
                    }
                }
            }

            if (role === 'seed1-opponent') {
                const otherTeam = placedTeams.find(t => t.role === 'other-game');
                if (otherTeam) {
                    if (newSeed < otherTeam.seed) {
                        alert(`RESEEDING MISTAKE!\n\nThe ${otherTeam.name} (#${otherTeam.seed}) are a lower seed than the ${newTeamName} (#${newSeed}).\n\nThe lowest seed must play the #1 Seed.`);
                        return false;
                    }
                }
            }
            return true;
        }
        
        // UPDATED: fillSlot now takes a data object, not a DOM element
        function fillSlot(slot, data) {
            slot.innerHTML = `
                <div class="logo-box" style="background:${data.color};">${data.logo}</div>
                <div class="team-info"><span class="name">${data.name}</span><span class="seed">${data.seed}</span></div>
            `;
            
            slot.classList.remove('empty-slot');
            slot.setAttribute('draggable', 'true');
            slot.setAttribute('data-conf', data.conf);
            slot.setAttribute('data-color', data.color);
            slot.setAttribute('data-team', data.dataName);
            slot.setAttribute('data-seed', data.seedNum);
            
            // NEW LOGIC: Update Header for Prediction
            const matchup = slot.closest('.matchup');
            if (matchup) {
                const metaHeader = matchup.querySelector('.game-meta span:first-child');
                if (metaHeader) {
                    const currentText = metaHeader.textContent;
                    // Don't overwrite if it's Live or Final
                    if (!currentText.includes('FINAL') && !currentText.includes('Live') && !currentText.includes('Prediction')) {
                        metaHeader.textContent = 'Prediction: ' + currentText;
                        metaHeader.style.color = '#FFD700'; // Gold color for predictions
                    }
                }
                // Check if we should add prediction inputs
                managePredictionInputs(matchup);
            }

            if (slot.id === 'sb-champion-slot') {
                slot.classList.add('ultimate-champion');
                throwConfetti();
                // Show Save Button
                document.getElementById('save-bracket-btn').style.display = 'flex';
                // Hide Inputs
                document.body.classList.add('bracket-complete');
            } else {
                setupDraggableItems();
            }
        }

        function clearSlot(slot) {
            // Hide Save Button if champion is removed
            if (slot.id === 'sb-champion-slot') {
                document.getElementById('save-bracket-btn').style.display = 'none';
                // Show Inputs
                document.body.classList.remove('bracket-complete');
            }

            // CLEANUP PREDICTION TITLE if matchup is emptied
            const matchup = slot.closest('.matchup');
            
            slot.innerHTML = '';
            slot.className = 'team-slot empty-slot';
            slot.removeAttribute('draggable');
            slot.removeAttribute('data-team');
            slot.removeAttribute('data-seed');
            slot.removeAttribute('data-color');

            if (matchup) {
                // Check if other slot is empty before resetting
                const otherSlot = Array.from(matchup.querySelectorAll('.team-slot')).find(s => s !== slot);
                if (otherSlot && otherSlot.classList.contains('empty-slot')) {
                    const metaHeader = matchup.querySelector('.game-meta span:first-child');
                    if (metaHeader && metaHeader.textContent.includes('Prediction:')) {
                        metaHeader.textContent = metaHeader.textContent.replace('Prediction: ', '');
                        metaHeader.style.color = ''; // Reset color
                    }
                }
                // Check if we should remove prediction inputs
                managePredictionInputs(matchup);
            }
        }

        function managePredictionInputs(matchup) {
            if (!matchup) return;
            
            // check if game is official (Live or Final)
            const metaHeader = matchup.querySelector('.game-meta span:first-child');
            if (metaHeader && (metaHeader.textContent.includes('FINAL') || metaHeader.classList.contains('live-text'))) {
                return; // Don't add inputs to finished/live games
            }

            const slots = matchup.querySelectorAll('.team-slot');
            const filledSlots = Array.from(slots).filter(s => !s.classList.contains('empty-slot'));

            // Check if BOTH slots are filled with valid teams
            if (filledSlots.length === 2) {
                // Add inputs if they don't exist
                filledSlots.forEach(slot => {
                    if (!slot.querySelector('.prediction-input') && !slot.querySelector('.score')) {
                        const input = document.createElement('input');
                        input.type = 'tel'; // triggers number pad on mobile
                        input.className = 'prediction-input';
                        input.placeholder = '-';
                        slot.appendChild(input);
                    }
                });
            } else {
                // Remove inputs if they exist (revert to just team info)
                slots.forEach(slot => {
                    const input = slot.querySelector('.prediction-input');
                    if (input) input.remove();
                });
            }
        }

        function updateBracketVisuals() {
            const allSlots = document.querySelectorAll('.team-slot[data-team]');
            
            allSlots.forEach(slot => {
                const id = slot.id || '';
                if (!slot.classList.contains('real-loser')) {
                     slot.classList.remove('winner', 'eliminated');
                     // NEW: Reset dynamic colors when clearing status
                     slot.style.borderLeftColor = '';
                     slot.style.background = '';
                }
            });

            allSlots.forEach(slot => {
                const team = slot.getAttribute('data-team');
                const col = slot.closest('.column');
                if(!team || !col) return;
                
                let nextRoundClass = '';
                if(col.className === 'column') nextRoundClass = 'col-divisional';
                else if(col.className.includes('col-divisional')) nextRoundClass = 'col-conference';
                else if(col.className.includes('col-conference')) nextRoundClass = 'sb-column';
                
                if (nextRoundClass) {
                    const nextSlots = document.querySelectorAll('.' + nextRoundClass + ' .team-slot[data-team="' + team + '"]');
                    if (nextSlots.length > 0) {
                        slot.classList.add('winner');
                        
                        // NEW: Apply Team Color Highlight
                        const teamColor = slot.getAttribute('data-color');
                        if (teamColor) {
                            slot.style.borderLeftColor = teamColor;
                            // Add a subtle gradient of the team color
                            slot.style.background = `linear-gradient(90deg, #252525, ${teamColor}33)`;
                        }

                        const matchup = slot.closest('.matchup');
                        if (matchup) {
                            matchup.querySelectorAll('.team-slot').forEach(opp => {
                                if (opp !== slot) opp.classList.add('eliminated');
                            });
                        }
                    }
                }
            });
        }

        function throwConfetti() {
            const box = document.getElementById('confetti-box');
            const colors = ['#FFD700', '#ff0000', '#0000ff', '#ffffff'];
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti-piece');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                const duration = Math.random() * 3 + 2 + 's';
                const delay = Math.random() * 2 + 's';
                confetti.style.animation = `fall ${duration} linear ${delay} forwards`;
                box.appendChild(confetti);
            }
        }

        /* -----------------------------------------------------------
           NEW: LIVE SCORING INTEGRATION (ESPN API)
           ----------------------------------------------------------- */
        async function initLiveScoring() {
            // Using HTTPS to avoid mixed content warnings
            const API_URL = 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard';
            
            async function fetchAndRender() {
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    
                    data.events.forEach(event => {
                        const competition = event.competitions[0];
                        const statusDetail = event.status.type.detail; // e.g. "Final", "Q4 2:00"
                        const isLive = event.status.type.state === 'in';
                        const isFinal = event.status.type.state === 'post';
                        
                        competition.competitors.forEach(comp => {
                            const teamName = comp.team.name; // e.g. "Bills", "49ers"
                            const currentScore = comp.score;
                            
                            // Find the opponent in the API data to validate the matchup
                            const apiOpponent = competition.competitors.find(c => c.id !== comp.id)?.team.name;

                            // Find all instances of this team in the bracket
                            const teamSlots = document.querySelectorAll(`.team-slot[data-team="${teamName}"]`);
                            
                            teamSlots.forEach(slot => {
                                // VALIDATION: Only update if the bracket matchup matches the API matchup
                                const matchup = slot.closest('.matchup');
                                if (!matchup) return;

                                // Find the opponent slot in the DOM
                                const siblingSlots = Array.from(matchup.querySelectorAll('.team-slot'));
                                const opponentSlot = siblingSlots.find(s => s !== slot);
                                const bracketOpponent = opponentSlot ? opponentSlot.getAttribute('data-team') : null;

                                // If the bracket slot doesn't have a valid opponent (e.g. empty/TBD), 
                                // or if the opponent doesn't match the API event, DO NOT update.
                                // This prevents scores carrying over to future rounds or headers updating for future games.
                                if (!bracketOpponent || bracketOpponent !== apiOpponent) {
                                    return;
                                }

                                // 1. Update Score
                                // Only add score span if prediction input is NOT there (or replace it if game went live)
                                let scoreEl = slot.querySelector('.score');
                                const predictionInput = slot.querySelector('.prediction-input');
                                
                                if (isLive || isFinal) {
                                    // Remove prediction input if game is now real
                                    if (predictionInput) predictionInput.remove();
                                    
                                    if (!scoreEl) {
                                        scoreEl = document.createElement('span');
                                        scoreEl.className = 'score';
                                        slot.appendChild(scoreEl);
                                    }
                                    if (currentScore !== undefined) {
                                        scoreEl.textContent = currentScore;
                                        slot.setAttribute('data-score', currentScore);
                                    }
                                }

                                // 2. Update Game Clock / Status (only for the specific matchup wrapper)
                                // We already validated that this matchup corresponds to the API event
                                const metaSpan = matchup.querySelector('.game-meta span:first-child');
                                // Only overwrite hardcoded times if the game is actually Live or Final
                                if (metaSpan && (isLive || isFinal)) {
                                    // MODIFIED: Force UPPERCASE for consistency (e.g. "FINAL")
                                    metaSpan.textContent = statusDetail.toUpperCase();
                                    metaSpan.style.color = ''; // Reset prediction color if game is real
                                    
                                    if (isLive) {
                                        metaSpan.classList.add('live-text');
                                    } else {
                                        metaSpan.classList.remove('live-text');
                                    }
                                }

                                // 3. Update Highlights Button
                                // Logic: If Final, show "Watch" if link exists, or "Awaiting" if not.
                                if (isFinal) {
                                    let btn = matchup.querySelector('.highlight-btn');
                                    const highlightUrl = matchup.getAttribute('data-highlight-url');

                                    if (!btn) {
                                        // Create button if it doesn't exist
                                        btn = document.createElement('a');
                                        btn.className = 'highlight-btn';
                                        btn.target = '_blank';
                                        matchup.appendChild(btn);
                                    }

                                    if (highlightUrl && highlightUrl.trim() !== "") {
                                        // Link exists
                                        btn.href = highlightUrl;
                                        btn.textContent = "Watch Highlights";
                                        btn.classList.remove('disabled');
                                    } else {
                                        // Link missing
                                        btn.removeAttribute('href');
                                        btn.textContent = "Awaiting Highlights";
                                        btn.classList.add('disabled');
                                    }
                                }
                            });
                        });
                    });
                    // console.log("Scores updated from ESPN API");
                } catch (error) {
                    console.warn("Could not fetch live scores:", error);
                }
            }

            // Initial fetch
            fetchAndRender();
            
            // Poll every 60 seconds
            setInterval(fetchAndRender, 60000);
        }

        // Start the live scoring system
        initLiveScoring();
        
        // Initial visual update to color hardcoded winners
        updateBracketVisuals();
        
        // NEW: Initial check to add prediction inputs to pre-filled games (like Divisional round)
        document.querySelectorAll('.matchup').forEach(m => managePredictionInputs(m));

        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes fall {
                0% { top: -20px; opacity: 1; transform: rotate(0deg); }
                100% { top: 100vh; opacity: 0; transform: rotate(720deg); }
            }
        `;
        document.head.appendChild(styleSheet);
    </script>

</body>
</html>
